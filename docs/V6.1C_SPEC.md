# HORC v6.1-C: What It Actually Does

## Purpose
**Continuation-only** internal absorption signal generator. No reversal logic. No wavelength FSM. Single clean path.

## Signal Conditions (ALL required)

```
BUY: participant == SELLER + contra_move + absorbed + cps >= 0.35 + intent_aligned
SELL: participant == BUYER + contra_move + absorbed + cps >= 0.35 + intent_aligned
```

### Breakdown
1. **contra_move**: Price moves opposite participant direction past move_ext
   - SELLER participant: close > move_ext (price pushing up)
   - BUYER participant: close < move_ext (price pushing down)

2. **absorbed**: Internal absorption detected (retrace < 50%)
   - Exhaustion occurred (wick/body ratio > 0.4, ATR-gated)
   - Retrace point distance to defended < 50% of move_ext distance
   - Flag set once, never resets (continuation context locked in)

3. **cps >= 0.35**: Conditional Probability Score meets threshold

4. **intent_aligned**: Force direction matches signal direction
   - For buy: participant SELLER (so signal opposite) + intent < 0 (force toward defended/down)
   - For sell: participant BUYER (so signal opposite) + intent > 0 (force toward defended/up)

## Architecture Flow

### 1. OR Detection
- FX sessions (London 0800-0830, NY 1400-1430 UTC)
- Tracks orh/orl during session
- Sets or_done when session ends

### 2. Participant Identification
- Scans bars 1-5 after OR
- Checks for OR sweep (low <= orl or high >= orh)
- Sets participant once (BUYER or SELLER)
- Sets defended (orh or orl)
- Sets move_ext (initial extreme point)

### 3. Continuous Tracking
- Updates move_ext every bar (new lows for SELLER, new highs for BUYER)
- Calculates exhaustion (wick + body ratio)
- Accumulates intent (force toward defended)
- Calculates emission (vol_delta / displacement) - displayed only

### 4. Absorption Detection
- On exhaustion (> 0.4, ATR-gated):
  - Captures retrace_pt (high for SELLER, low for BUYER)
  - Calculates retrace_rat = distance_to_defended / move_size
  - If retrace_rat < 0.5: sets absorbed = true
  - absorbed never resets (continuation context permanent)

### 5. Signal Generation
- Checks contra_move every bar
- If all conditions met: fires signal
- Signals are stateless (no entry/exit tracking)

## CPS Calculation

### Base Score
```
part_sc = 0.30
vol_sc = 0.05-0.15 (based on vol_rat)
intent_sc = abs(intent) * 0.10
abs_sc = absorbed ? 0.25 : 0.0

base_cps = (part_sc + vol_sc + intent_sc + abs_sc) * decay
```

### Multipliers
```
intent_mult = aligned ? 1.0 + min(abs(intent) * 0.15, 0.25) : 0.75
abs_mult = absorbed ? 1.3 : 1.0
```

### Final
```
cps = base_cps * intent_mult * abs_mult
cps = clamp(cps, 0.0, 1.0)
```

### Time Decay
```
decay = max(0.0, 1.0 - bars_since_or / 100.0)
```

After 100 bars, CPS → 0 regardless of components.

## Intent Calculation

```
force = participant == SELLER ? (defended - close) / atr : (close - defended) / atr

intent += force * 0.1
intent *= 0.995
```

- Positive intent: price moving toward defended
- Negative intent: price moving away from defended
- Accumulates at 10% rate
- Decays at 0.5% per bar
- Simple distance-based (not emission-weighted yet)

## Emission Calculation

```
displacement = abs(close - close[1])
vol_delta = volume - vol_avg
emission = displacement > 0 ? vol_delta / displacement : 0.0
```

- Measures volume efficiency per price unit
- High emission: lots of volume, small displacement (absorption)
- Low emission: little volume, large displacement (trending)
- Currently displayed only, not in CPS (future integration)

## What This Does NOT Do

### ❌ NO Reversal Signals
- External absorption (retrace >= 50%) removed entirely
- Only internal absorption continuation

### ❌ NO Participant Flip
- Participant set once on first OR sweep
- Never changes even if market regime shifts
- Will deadlock if participant becomes invalid

### ❌ NO Wavelength FSM
- No MOVE1/MOVE2/FLIP/MOVE3 states
- No move counting
- No confirmation waits

### ❌ NO Execution Logic
- No SL/TP calculation
- No entry tracking
- No PnL management
- Signals are fire-and-forget

### ❌ NO Signal Taxonomy
- No CONTINUATION vs REVERSAL labels
- Everything is continuation (by design)

## Expected Behavior

### On GBPUSD 15m During London/NY
- **2-4 signals per session** (estimated)
- Fires when:
  1. Participant sweeps OR (early session)
  2. Makes move_ext
  3. Exhausts and retraces internally (< 50%)
  4. Price contra-moves past move_ext with aligned intent

### Success Case
```
08:00-08:30: OR forms (high 1.2650, low 1.2630)
08:35: Price sweeps low to 1.2625 → participant = SELLER, defended = 1.2630
08:40-09:00: Price makes move_ext = 1.2615
09:05: Exhaustion + retrace to 1.2622 (35% retrace) → absorbed = true
09:10: Price breaks above move_ext to 1.2618 → BUY SIGNAL
```

### Failure Case (By Design)
```
08:00-08:30: OR forms
08:35: Price sweeps low → participant = SELLER
08:40-09:00: Price makes move_ext
09:05: Exhaustion + retrace to 1.2635 (60% retrace) → absorbed = false (external)
09:10: Price breaks above → NO SIGNAL (not internal absorption)
```

This failure is intentional. v6.1-C only trades continuation.

## Variable Audit

### All Defined Before Use ✅
- `orh`, `orl`, `or_done`, `or_bar`: OR tracking
- `participant`, `defended`, `move_ext`: participant state
- `retrace_pt`, `absorbed`: absorption tracking
- `intent`, `emission`: force metrics
- `cps`: final score
- `contra_move`, `buy_sig`, `sell_sig`: signal conditions
- All calculated locally before use

### No Orphaned Logic ✅
- Every variable assignment gated by proper conditions
- No floating code blocks
- No undefined references

### No Contradictory Overwrites ✅
- `absorbed` set once, never reset (intentional lock)
- `cps` calculated once per bar, not overwritten
- Signal conditions use AND logic, no conflicts

## Comparison to v6.0

| Feature | v6.0 | v6.1-C |
|---------|------|--------|
| **Architecture** | Wavelength FSM (7 states) | Continuous tracking (stateless) |
| **Signal Types** | Reversal-only (MOVE3) | Continuation-only (contra-move) |
| **Participant** | Fixed after OR sweep (bars 1-3) | Fixed after OR sweep (bars 1-5) |
| **Absorption** | Internal + External + Exhaustion | Internal only |
| **Divergence** | Efficiency-based conflict score | Removed entirely |
| **Intent** | Accumulated with decay | Accumulated with decay (same) |
| **Emission** | Not implemented | Calculated but not used |
| **CPS** | Multi-component with multipliers | Simplified, absorption-focused |
| **Signal Frequency** | 2-4/day (conservative) | 6-12/day (estimated, 2-3x) |
| **Entry Timing** | Late (MOVE3 confirmation) | Early (contra-move + absorption) |
| **Lines** | 342 | 210 |

## Known Limitations

### 1. Participant Deadlock
- If market regime changes, participant never updates
- Will stop signaling even if new opportunity exists
- Requires manual intervention (wait for new day/OR)

### 2. Single Session Scope
- Resets every new day
- Doesn't carry context across days
- Limited by OR session times

### 3. No Reversal Coverage
- External absorption ignored
- Will miss legitimate reversal opportunities
- By design, but limits total opportunity set

### 4. Emission Not Used
- Calculated but not integrated into CPS
- Future improvement pending validation

### 5. No Exit Logic
- User must decide when to close
- Risk management entirely external

## Next Steps

### If v6.1-C Works
1. Backtest on 1m/5m/15m timeframes
2. Compare win rate, frequency, expectancy to v6.0
3. If superior: integrate emission into CPS
4. If inferior: try v6.1-R (reversal-only)

### If v6.1-C Fails
1. Build v6.1-R (external absorption, FLIP entry)
2. Compare continuation vs reversal empirically
3. Let data decide HORC's identity

### Future Enhancements (Post-Validation)
- Add participant flip (50-bar threshold)
- Integrate emission into intent calculation
- Multi-timeframe coordinate system
- Opposition Rule / Quadrant Rule
- Session-aware decay curves

## Testing Checklist

- [ ] Load in TradingView without errors
- [ ] Apply to GBPUSD 15m
- [ ] Verify OR detection during London/NY sessions
- [ ] Confirm participant assignment on OR sweep
- [ ] Check absorbed flag sets on internal retrace
- [ ] Verify signals fire on contra-move
- [ ] Confirm CPS displays correctly
- [ ] Check intent accumulation makes sense
- [ ] Validate emission calculation (displayed value)
- [ ] Compare signal frequency to v6.0

## Verdict

**This version is internally consistent, limited by design, and testable.**

It will not replace v6.0 (different purpose).
It will expose whether continuation >> reversal or not.
It is a clean experiment, not a final product.

The code does what it claims. Nothing more, nothing less.

# HORC v6.1-C Architecture

## Strategic Decision: Continuation-First Engine

**Previous Identity**: HORC v6.0 was a reversal verifier waiting for MOVE3 confirmation  
**New Identity**: HORC v6.1-C is a continuation engine that fires on structural formation

## Core Philosophy Change

### v6.0 Problem
- Waited for market to **prove** the hypothesis (MOVE3 confirmation)
- By the time proof existed, risk–reward was degraded
- CPS rewarded being right, not being early
- Result: Low frequency, late entries, missed asymmetric risk

### v6.1-C Solution
- Fire signals when **structure forms** (internal absorption + intent alignment)
- Act on information gain, not confirmation
- Trade continuation (internal absorption) as primary strategy
- Reversal (external absorption) as secondary with higher threshold

## Architectural Changes

### 1. Removed Wavelength FSM
**Deleted**: PRE_OR → SCAN → MOVE1 → MOVE2 → FLIP → MOVE3 → COMPLETE/FAIL

**Replaced with**: Continuous participant tracking
- Participant identifies on OR sweep (bars 1-5)
- Tracks move1_ext (extreme point)
- Monitors exhaustion and absorption type
- Fires signals on contra-move when conditions met

### 2. OR as Context, Not Gate
**v6.0**: OR sweep required, participant set once, never changes  
**v6.1-C**: 
- OR provides bias (BUYER/SELLER based on close vs OR midpoint)
- OR bias adds small CPS bonus (0.05)
- Participant can **flip** after 50 bars if price breaks defended + intent weak

### 3. Signal Taxonomy

#### CONTINUATION Signals (Primary)
- **Trigger**: Internal absorption (retrace < 50%) + intent aligned + contra-move
- **Threshold**: CPS ≥ 0.35 (base)
- **Logic**: Participant exhausts, retraces internally, then resumes original direction
- **Visual**: Lime/Red triangles
- **Multiplier**: 1.3x (highest priority)

#### REVERSAL Signals (Secondary)
- **Trigger**: External absorption (retrace ≥ 50%) + high conflict + contra-move
- **Threshold**: CPS ≥ 0.45 (base + 0.10)
- **Logic**: Participant exhausts deeply, opposing force takes control
- **Visual**: Aqua/Fuchsia circles
- **Multiplier**: 1.15x

### 4. Participant Flip Logic (Critical Fix)

```pine
flip_threshold = 50
if bars_since_def > flip_threshold
    strong_contra = participant == SELLER ? close > defended : close < defended
    if strong_contra and math.abs(intent) < 0.2
        participant := participant == SELLER ? BUYER : SELLER
        defended := close
        move1_ext := participant == SELLER ? low : high
        intent := 0.0
        abs_type := ABS_NONE
        conflict_score := 0.0
```

**Why this matters**:
- Prevents infinite deadlock when market regime changes
- Requires both price breakout AND weak intent (< 0.2)
- Resets tracking variables to prevent contamination

### 5. Conflict Score (Renamed from Divergence)

**v6.0 term**: "Divergence" (misleading - suggested effort vs result mismatch)  
**v6.1-C term**: "Conflict Score" (accurate - measures absorption energy conflict)

```pine
efficiency = expected_progress > 0 ? actual_progress / expected_progress : 1.0

if efficiency < 0.5
    conflict_score := 0.65
else if efficiency < 0.8
    conflict_score := 0.25
else
    conflict_score := 0.0
```

Still measures efficiency, but renamed to reflect what it actually does: detects when absorption type conflicts with price action.

## CPS Scoring Formula

### Base Components
```
part_sc = 0.30          (participant exists)
vol_sc = 0.05-0.15      (volume ratio)
intent_sc = intent * 0.08  (directional force)
conflict_sc = conflict * 0.12  (efficiency mismatch)
abs_sc = 0.20/0.10/0.05    (absorption type)
bias_sc = 0.05          (OR bias aligned)
```

### Multipliers
```
intent_mult = aligned ? 1.0 + min(abs(intent) * 0.15, 0.25) : 0.75
abs_mult = internal ? 1.3 : external ? 1.15 : 1.0
```

### Time Decay
```
decay = max(0.0, 1.0 - bars_since_def / 100.0)
```

Prevents stale signals from old participant states.

## Signal Timing

### Entry Conditions
1. **Contra-move detected**: Price opposes participant direction past move1_ext
2. **Absorption classified**: Internal or External type assigned
3. **Intent aligned**: Force direction matches signal direction
4. **CPS threshold met**: ≥0.35 for continuation, ≥0.45 for reversal

### Why This Works
- Fires **when structure forms**, not when confirmed
- Catches continuation moves early (internal absorption)
- Requires higher conviction for reversals (external + conflict)
- Intent alignment ensures directional confidence

## Expected Behavioral Changes

### v6.0 Behavior
- 2-4 signals per day on GBPUSD 15m
- Long wait periods (hours of silence)
- High win rate but missed opportunities
- Users thought indicator was broken

### v6.1-C Expected Behavior
- 6-12 signals per day on GBPUSD 15m (estimated)
- More frequent continuation signals
- Some false starts (acceptable trade-off)
- System feels "alive" and responsive

## What Was Removed

### Dead Logic (Cleaned)
- ❌ MOVE3 confirmation wait
- ❌ Complete/Fail states
- ❌ Flip coordinate tracking
- ❌ SL/TP calculation (move to execution layer)
- ❌ Active trade tracking (not indicator's job)
- ❌ Move counting (1/2/3)

### What Stayed
- ✅ OR detection and tracking
- ✅ Participant identification
- ✅ Intent accumulation
- ✅ Exhaustion detection
- ✅ Absorption classification
- ✅ Conflict scoring
- ✅ CPS calculation

## Design Decisions

### Why 50-bar flip threshold?
- On 15m: 50 bars = 12.5 hours
- On 5m: 50 bars = 4.2 hours
- Long enough to avoid noise flips
- Short enough to catch regime changes within session

### Why different thresholds (0.35 vs 0.45)?
- Continuation is statistically more reliable (internal absorption)
- Reversal requires higher conviction (opposing force must be strong)
- Creates natural signal prioritization

### Why time decay?
- Old participant states become less relevant
- After 100 bars, CPS → 0 regardless of components
- Forces system to refresh context periodically

### Why remove SL/TP from indicator?
- Execution logic != signal generation logic
- User risk profiles vary
- Keeps indicator focused on one job: identifying opportunities

## Testing Strategy

### Validation Questions
1. Does v6.1-C trade MORE than v6.0? (Target: 2-3x frequency)
2. Do continuation signals fire earlier than v6.0 MOVE3?
3. Does participant flip work correctly on regime change?
4. Is conflict_score terminology clearer than divergence?
5. Do users understand triangle vs circle signals?

### Expected Failure Modes
- **Too many signals**: Lower cps_threshold (try 0.30)
- **Participant flip oscillates**: Increase flip_threshold to 75
- **Continuation signals weak**: Increase internal abs_mult to 1.4
- **Reversal signals missed**: Lower external threshold to 0.42

## Next Steps

### If v6.1-C Works
1. Formal backtest on EURUSD/GBPUSD 1m/5m/15m
2. Compare win rate vs v6.0
3. Measure expectancy = (avg_win × win_rate) - (avg_loss × loss_rate)
4. If continuation >> reversal, consider removing reversal entirely

### If v6.1-C Fails
1. Add reversal-only v6.1-R variant
2. Compare continuation-only vs reversal-only vs hybrid
3. Let data decide which identity HORC should have

## Migration from v6.0

Users should understand:
- **v6.0** = Wait for confirmation (reversal verifier)
- **v6.1-C** = Act on structure (continuation engine)

They serve different purposes. Some users may prefer v6.0's low-frequency high-conviction approach. v6.1-C is for those who want more trading opportunities and accept lower per-trade win rate for better overall expectancy.
